 
{
    "id": "tpa-1010101010",
    "version": "1.0.0",
    "type": "agreement",
    "context": {
        "validity": {
            "initial": "2017-10-15",
            "timeZone": "America/Los_Angeles"
        },
        "infrastructure": {
            "registry": "http://registry.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/api/v6",
            "reporter": "http://reporter.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/api/v4",
            "render": "https://ui.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/render?model=https://registry.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/api/v6/agreements/tpa-1010101010&view=/renders/tpa/default.html&ctrl=/renders/tpa/default.js",
            "dashboard": "http://dashboard.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}",
            "scopeManager": "https://sm.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/api/v1"
        },
        "definitions": {
            "schemas": {},
            "scopes": {
                "development": {
                    "project": {
                        "name": "Project",
                        "description": "Project",
                        "type": "string",
                        "default": "1010101010"
                    },
                    "class": {
                        "name": "Class",
                        "description": "Group some projects",
                        "type": "string",
                        "default": "2020202020"
                    }
                }
            },
            "computers": {
                "pivotaltracker": {
                    "url": "http://pt.collector.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}",
                    "apiVersion": "1",
                    "config": {
                        "ptkey": "1313131313",
                        "schedules": {
                            "24x7": "L-DT00:00-23:59/H",
                            "normal": "[{\"from\":\"1/1\",\"to\":\"6/14\",\"schedule\":\"L-VT09:00-18:00/H\"},{\"from\":\"6/15\",\"to\":\"9/15\",\"schedule\":\"L-VT08:30-15:00/H\"},{\"from\":\"9/16\",\"to\":\"12/23\",\"schedule\":\"L-VT09:00-18:00/H\"},{\"from\":\"12/24\",\"to\":\"12/24\",\"schedule\":\"L-VT09:00-13:00/H\"},{\"from\":\"12/25\",\"to\":\"12/30\",\"schedule\":\"L-VT09:00-18:00/H\"},{\"from\":\"12/31\",\"to\":\"12/31\",\"schedule\":\"L-VT09:00-13:00/H\"}]"
                        },
                        "holidays": "http://registry.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/static/holidays.json"
                    }
                },
                "eventcomputer": {
                    "url": "http://event.collector.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}",
                    "endpoint": "/computations",
                    "apiVersion": "2",
                    "config": {
                        "scopeManager": "http://sm.{{SERVICES_PREFIX}}{{DNS_SUFFIX}}/api/v1/scopes/development"
                    }
                }
            }
        }
    },
    "terms": {
        "metrics": {
            "NUMBER_PIVOTAL_STARTED_STORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "started"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_PIVOTAL_FINISHED_STORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "finished"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_PIVOTAL_ACCEPTED_STORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "accepted"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_PIVOTAL_DELIVERED_STORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "delivered"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_GITHUB_NEW_BRANCH": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "github": {
                            "events": {
                                "type": "CreateEvent",
                                "payload": {
                                    "ref_type": "branch"
                                }
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_GITHUB_OPEN_PR": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "github": {
							"allPR": {
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_GITHUB_MERGE_PR_OLD": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "github": {
                            "events": {
                                "type": "PullRequestEvent",
                                "payload": {
                                    "action": "closed",
                                    "pull_request": {
                                        "base": {
                                            "label": "%GITHUB.REPO_OWNER%:master"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"NUMBER_GITHUB_MERGE_PR": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "github": {
							"mergedPR": {
								"base": {
									"label": "%GITHUB.REPO_OWNER%:master"
								}
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "NUMBER_HEROKU_RELEASES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "heroku": {
                            "releases": {
                                "status": "succeeded",
                                "description": "%CONTAINS%Deploy"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"NUMBER_TRAVIS_BUILDS": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "travis": {
							"builds_public": {
								"@type": "build"
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"NUMBER_TRAVIS_FAILED_BUILDS": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "travis": {
							"builds_public": {
								"@type": "build",
								"state": "failed"
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"NUMBER_CC_COVERAGE": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "codeclimate": {
							"coverage": {
								"data": {
									"attributes": {
										"covered_percent": "%HIGHER_OR_EQUAL%0"
									}
								}
								
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"NUMBER_CC_COVERAGE_OVER_80": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": "number",
                    "event": {
                        "codeclimate": {
							"coverage": {
								"data": {
									"attributes": {
										"covered_percent": "%HIGHER%80"
									}
								}	
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "PERCENTAGE_NEWBRANCH_STARTEDSTORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "percentage": {
                            "related": {
                                "github": {
                                    "events": {
                                        "type": "CreateEvent",
                                        "payload": {
                                            "ref_type": "branch"
                                        }
                                    }
                                },
                                "window": 86400
                            }
                        }
                    },
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "started"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "PERCENTAGE_OPENPR_FINISHEDSTORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "percentage": {
                            "related": {
                                "github": {
									"allPR": {
									}
								},
                                "window": 86400
                            }
                        }
                    },
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "finished"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "PERCENTAGE_MERGEPR_DELIVEREDSTORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "percentage": {
                            "related": {
                                "github": {
									"mergedPR": {
										"base": {
											"label": "%GITHUB.REPO_OWNER%:master"
										}
									}
								},
                                "window": 86400
                            }
                        }
                    },
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "delivered"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "PERCENTAGE_RELEASES_DELIVEREDSTORIES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "percentage": {
                            "related": {
                                "heroku": {
                                    "releases": {
                                        "status": "succeeded",
                                        "description": "%CONTAINS%Deploy"
                                    }
                                },
                                "window": 86400
                            }
                        }
                    },
                    "event": {
                        "pivotal": {
                            "activity": {
                                "highlight": "delivered"
                            }
                        }
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"PERCENTAGE_FAILEDBUILDS_BUILDS": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "percentage": {
                            "related": {
                                "travis": {
									"builds_public": {
										"@type": "build",
										"state": "failed"
									}
								},
                                "window": 86400
                            }
                        }
                    },
                    "event": {
                        "travis": {
							"builds_public": {
								"@type": "build"
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
			"PERCENTAGE_80COVERAGE_COVERAGE": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "percentage": {
                            "related": {
                                "codeclimate": {
									"coverage": {
										"data": {
											"attributes": {
												"covered_percent": "%HIGHER%80"
											}
										}
										
									}
								},
                                "window": 86400
                            }
                        }
                    },
                    "event": {
                        "codeclimate": {
							"coverage": {
								"data": {
									"attributes": {
										"covered_percent": "%HIGHER_OR_EQUAL%0"
									}
								}
								
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "VALUE_CC_COVERAGE": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "value": {
                            "parameter": "attributes.covered_percent",
                            "return": "min"
                        }
                    },
                    "event": {
                        "codeclimate": {
							"coverage": {	
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "VALUE_GITHUB_MERGE_PR_ADDITIONS": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "value": {
                            "parameter": "additions",
                            "return": "max"
                        }
                    },
                    "event": {
                        "github": {
							"closedPRFiles": {
								"base": {
									"label": "%GITHUB.REPO_OWNER%:master"
								}
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "VALUE_GITHUB_MERGE_PR_DELETIONS": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "value": {
                            "parameter": "deletions",
                            "return": "max"
                        }
                    },
                    "event": {
                        "github": {
							"closedPRFiles": {
								"base": {
									"label": "%GITHUB.REPO_OWNER%:master"
								}
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            },
            "VALUE_GITHUB_MERGE_PR_CHANGES": {
                "computer": {
                    "$ref": "#/context/definitions/computers/eventcomputer"
                },
                "measure": {
                    "computing": "actual",
                    "element": {
                        "value": {
                            "parameter": "changes",
                            "return": "max"
                        }
                    },
                    "event": {
                        "github": {
							"closedPRFiles": {
								"base": {
									"label": "%GITHUB.REPO_OWNER%:master"
								}
							}
						}
                    },
                    "scope": {
                        "$ref": "#/context/definitions/scopes/development"
                    }
                }
            }
        },
        "guarantees": [			
            {
                "id": "MORE_THAN_70_PERCENT_CC_CODE_COVERED",
                "notes": "#### Description\r\n```\r\nTP-1: More than 70% of coverage",
                "description": "Extracted from CodeClimate test reports",
                "scope": {
                    "$ref": "#/context/definitions/scopes/development"
                },
                "of": [
                    {
                        "scope": {
                            "project": "1010101010"
                        },
                        "objective": "VALUE_CC_COVERAGE >= 70",
                        "with": {
                            "VALUE_CC_COVERAGE": {}
                        },
                        "window": {
                            "type": "static",
                            "period": "daily",
                            "initial": "2018-01-01"
                        }
                    }
                ]
            },
            {
                "id": "MORE_THAN_10_PR_ADDITIONS",
                "notes": "#### Description\r\n```\r\nTP-1: More than 10 additions",
                "description": "Extracted from Github Pull Requests files",
                "scope": {
                    "$ref": "#/context/definitions/scopes/development"
                },
                "of": [
                    {
                        "scope": {
                            "project": "1010101010"
                        },
                        "objective": "VALUE_GITHUB_MERGE_PR_ADDITIONS > 10",
                        "with": {
                            "VALUE_GITHUB_MERGE_PR_ADDITIONS": {}
                        },
                        "window": {
                            "type": "static",
                            "period": "daily",
                            "initial": "2018-01-01"
                        }
                    }
                ]
            },
            {
                "id": "MORE_THAN_10_PR_DELETIONS",
                "notes": "#### Description\r\n```\r\nTP-1: More than 10 deletions",
                "description": "Extracted from Github Pull Requests files",
                "scope": {
                    "$ref": "#/context/definitions/scopes/development"
                },
                "of": [
                    {
                        "scope": {
                            "project": "1010101010"
                        },
                        "objective": "VALUE_GITHUB_MERGE_PR_DELETIONS > 10",
                        "with": {
                            "VALUE_GITHUB_MERGE_PR_DELETIONS": {}
                        },
                        "window": {
                            "type": "static",
                            "period": "daily",
                            "initial": "2018-01-01"
                        }
                    }
                ]
            },
            {
                "id": "MORE_THAN_10_PR_CHANGES",
                "notes": "#### Description\r\n```\r\nTP-1: More than 10 changes",
                "description": "Extracted from Github Pull Requests files",
                "scope": {
                    "$ref": "#/context/definitions/scopes/development"
                },
                "of": [
                    {
                        "scope": {
                            "project": "1010101010"
                        },
                        "objective": "VALUE_GITHUB_MERGE_PR_CHANGES > 10",
                        "with": {
                            "VALUE_GITHUB_MERGE_PR_CHANGES": {}
                        },
                        "window": {
                            "type": "static",
                            "period": "daily",
                            "initial": "2018-01-01"
                        }
                    }
                ]
            }
        ]
    }
}
